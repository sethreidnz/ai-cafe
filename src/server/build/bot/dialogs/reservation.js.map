{"version":3,"sources":["../../../src/bot/dialogs/reservation.js"],"names":["builder","require","reservationService","DIALOG_NAMES","ENTITY_NAMES","registerReservationDialog","bot","dialog","RESERVATION","session","args","next","dialogData","reservation","reservationDate","EntityRecognizer","findEntity","entities","DATE_TIME","Prompts","time","date","results","parseTime","response","entity","number","groupSize","text","name","reservationDetails","choice","listStyle","ListStyle","button","toLowerCase","addItem","send","endDialog","replaceDialog"],"mappings":"AAAA,MAAMA,UAAUC,QAAQ,YAAR,CAAhB;AACA,SAASC,kBAAT,QAAmC,gBAAnC;AACA,SAASC,YAAT,EAAuBC,YAAvB,QAA2C,cAA3C;;AAEA,MAAMC,4BAA4BC,OAAO;AACvCA,MAAIC,MAAJ,CAAWJ,aAAaK,WAAxB,EAAqC,CACnC,CAACC,OAAD,EAAUC,IAAV,EAAgBC,IAAhB,KAAyB;AACvBF,YAAQG,UAAR,CAAmBC,WAAnB,GAAiC,EAAjC;AACA,UAAMC,kBAAkBJ,QAAQV,QAAQe,gBAAR,CAAyBC,UAAzB,CAC9BN,KAAKO,QADyB,EAE9Bb,aAAac,SAFiB,CAAhC;AAIA,QAAI,CAACJ,eAAL,EAAsB;AACpBd,cAAQmB,OAAR,CAAgBC,IAAhB,CACEX,OADF,EAEE,mCAFF;AAID,KALD,MAKO;AACLA,cAAQG,UAAR,CAAmBC,WAAnB,CAA+BQ,IAA/B,GAAsCP,eAAtC;AACAH;AACD;AACF,GAhBkC,EAiBnC,CAACF,OAAD,EAAUa,OAAV,KAAsB;AACpB,QAAI,CAACb,QAAQG,UAAR,CAAmBC,WAAnB,CAA+BC,eAApC,EAAqD;AACnD,YAAMA,kBAAkBd,QAAQe,gBAAR,CAAyBQ,SAAzB,CACtBD,QAAQE,QAAR,CAAiBC,MADK,CAAxB;AAGAhB,cAAQG,UAAR,CAAmBC,WAAnB,CAA+BQ,IAA/B,GAAsCP,eAAtC;AACD;AACDd,YAAQmB,OAAR,CAAgBO,MAAhB,CAAuBjB,OAAvB,EAAgC,gCAAhC;AACD,GAzBkC,EA0BnC,CAACA,OAAD,EAAUa,OAAV,KAAsB;AACpBb,YAAQG,UAAR,CAAmBC,WAAnB,CAA+Bc,SAA/B,GAA2CL,QAAQE,QAAnD;AACAxB,YAAQmB,OAAR,CAAgBS,IAAhB,CAAqBnB,OAArB,EAA+B,oCAA/B;AACD,GA7BkC,EA8BnC,CAACA,OAAD,EAAUa,OAAV,KAAsB;AACpBb,YAAQG,UAAR,CAAmBC,WAAnB,CAA+BgB,IAA/B,GAAsCP,QAAQE,QAA9C;AACA,UAAMM,qBAAqBrB,QAAQG,UAAR,CAAmBC,WAA9C;AACAb,YAAQmB,OAAR,CAAgBY,MAAhB,CACEtB,OADF,EAEG,UAASqB,mBAAmBD,IAAK,wCAAuCC,mBAAmBH,SAAU,eAAcG,mBAAmBT,IAAK,mBAF9I,EAGE,QAHF,EAIE,EAAEW,WAAWhC,QAAQiC,SAAR,CAAkBC,MAA/B,EAJF;AAMD,GAvCkC,EAwCnC,CAACzB,OAAD,EAAUa,OAAV,KAAsB;AACpB,QAAIA,QAAQE,QAAR,CAAiBC,MAAjB,CAAwBU,WAAxB,OAA0C,KAA9C,EAAqD;AACnD,YAAML,qBAAqBrB,QAAQG,UAAR,CAAmBC,WAA9C;AACAX,yBAAmBkC,OAAnB,CAA2BN,kBAA3B;AACArB,cAAQ4B,IAAR,CAAa,aAAb;AACA5B,cAAQ6B,SAAR;AACD,KALD,MAKO;AACL7B,cAAQ4B,IAAR,CAAa,wBAAb;AACA5B,cAAQ8B,aAAR,CAAsBpC,aAAaK,WAAnC;AACD;AACF,GAlDkC,CAArC;AAoDD,CArDD;;AAuDA,eAAeH,yBAAf","file":"reservation.js","sourcesContent":["const builder = require(\"botbuilder\");\r\nimport { reservationService } from \"../../database\";\r\nimport { DIALOG_NAMES, ENTITY_NAMES } from \"../constants\";\r\n\r\nconst registerReservationDialog = bot => {\r\n  bot.dialog(DIALOG_NAMES.RESERVATION, [\r\n    (session, args, next) => {\r\n      session.dialogData.reservation = {};\r\n      const reservationDate = args && builder.EntityRecognizer.findEntity(\r\n        args.entities,\r\n        ENTITY_NAMES.DATE_TIME\r\n      );\r\n      if (!reservationDate) {\r\n        builder.Prompts.time(\r\n          session,\r\n          \"What time would you like to book?\"\r\n        );\r\n      } else {\r\n        session.dialogData.reservation.date = reservationDate;\r\n        next();\r\n      }\r\n    },\r\n    (session, results) => {\r\n      if (!session.dialogData.reservation.reservationDate) {\r\n        const reservationDate = builder.EntityRecognizer.parseTime(\r\n          results.response.entity\r\n        );\r\n        session.dialogData.reservation.date = reservationDate;\r\n      }\r\n      builder.Prompts.number(session, \"How many people in your group?\");\r\n    },\r\n    (session, results) => {\r\n      session.dialogData.reservation.groupSize = results.response;\r\n      builder.Prompts.text(session, `Can I have a name for the booking?`);\r\n    },\r\n    (session, results) => {\r\n      session.dialogData.reservation.name = results.response;\r\n      const reservationDetails = session.dialogData.reservation;\r\n      builder.Prompts.choice(\r\n        session,\r\n        `Thanks ${reservationDetails.name}. You've asked to make a booking for ${reservationDetails.groupSize} people, on ${reservationDetails.date}.Is that correct?`,\r\n        \"Yes|No\",\r\n        { listStyle: builder.ListStyle.button }\r\n      );\r\n    },\r\n    (session, results) => {\r\n      if (results.response.entity.toLowerCase() === \"yes\") {\r\n        const reservationDetails = session.dialogData.reservation;\r\n        reservationService.addItem(reservationDetails);\r\n        session.send(\"Thank you!.\");\r\n        session.endDialog();\r\n      } else {\r\n        session.send(\"Okay lets try again...\");\r\n        session.replaceDialog(DIALOG_NAMES.RESERVATION);\r\n      }\r\n    }\r\n  ]);\r\n};\r\n\r\nexport default registerReservationDialog;\r\n"]}