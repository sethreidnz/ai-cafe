{"version":3,"sources":["../../../src/bot/dialogs/reservation.js"],"names":["builder","require","registerReservationDialog","bot","dialog","RESERVATION","session","args","next","dialogData","reservation","reservationDate","EntityRecognizer","findEntity","entities","DATE_TIME","Prompts","time","date","results","parseTime","response","entity","number","groupSize","text","name","reservationDetails","choice","listStyle","ListStyle","button","toLowerCase","addItem","send","endDialog","replaceDialog"],"mappings":";;;;;;AACA;;AACA;;AAFA,IAAMA,UAAUC,QAAQ,YAAR,CAAhB;;;AAIA,IAAMC,4BAA4B,SAA5BA,yBAA4B,MAAO;AACvCC,MAAIC,MAAJ,CAAW,wBAAaC,WAAxB,EAAqC,CACnC,UAACC,OAAD,EAAUC,IAAV,EAAgBC,IAAhB,EAAyB;AACvBF,YAAQG,UAAR,CAAmBC,WAAnB,GAAiC,EAAjC;AACA,QAAMC,kBAAkBJ,QAAQP,QAAQY,gBAAR,CAAyBC,UAAzB,CAC9BN,KAAKO,QADyB,EAE9B,wBAAaC,SAFiB,CAAhC;AAIA,QAAI,CAACJ,eAAL,EAAsB;AACpBX,cAAQgB,OAAR,CAAgBC,IAAhB,CACEX,OADF,EAEE,mCAFF;AAID,KALD,MAKO;AACLA,cAAQG,UAAR,CAAmBC,WAAnB,CAA+BQ,IAA/B,GAAsCP,eAAtC;AACAH;AACD;AACF,GAhBkC,EAiBnC,UAACF,OAAD,EAAUa,OAAV,EAAsB;AACpB,QAAI,CAACb,QAAQG,UAAR,CAAmBC,WAAnB,CAA+BC,eAApC,EAAqD;AACnD,UAAMA,kBAAkBX,QAAQY,gBAAR,CAAyBQ,SAAzB,CACtBD,QAAQE,QAAR,CAAiBC,MADK,CAAxB;AAGAhB,cAAQG,UAAR,CAAmBC,WAAnB,CAA+BQ,IAA/B,GAAsCP,eAAtC;AACD;AACDX,YAAQgB,OAAR,CAAgBO,MAAhB,CAAuBjB,OAAvB,EAAgC,gCAAhC;AACD,GAzBkC,EA0BnC,UAACA,OAAD,EAAUa,OAAV,EAAsB;AACpBb,YAAQG,UAAR,CAAmBC,WAAnB,CAA+Bc,SAA/B,GAA2CL,QAAQE,QAAnD;AACArB,YAAQgB,OAAR,CAAgBS,IAAhB,CAAqBnB,OAArB;AACD,GA7BkC,EA8BnC,UAACA,OAAD,EAAUa,OAAV,EAAsB;AACpBb,YAAQG,UAAR,CAAmBC,WAAnB,CAA+BgB,IAA/B,GAAsCP,QAAQE,QAA9C;AACA,QAAMM,qBAAqBrB,QAAQG,UAAR,CAAmBC,WAA9C;AACAV,YAAQgB,OAAR,CAAgBY,MAAhB,CACEtB,OADF,cAEYqB,mBAAmBD,IAF/B,6CAE2EC,mBAAmBH,SAF9F,oBAEsHG,mBAAmBT,IAFzI,wBAGE,QAHF,EAIE,EAAEW,WAAW7B,QAAQ8B,SAAR,CAAkBC,MAA/B,EAJF;AAMD,GAvCkC,EAwCnC,UAACzB,OAAD,EAAUa,OAAV,EAAsB;AACpB,QAAIA,QAAQE,QAAR,CAAiBC,MAAjB,CAAwBU,WAAxB,OAA0C,KAA9C,EAAqD;AACnD,UAAML,qBAAqBrB,QAAQG,UAAR,CAAmBC,WAA9C;AACA,mCAAmBuB,OAAnB,CAA2BN,kBAA3B;AACArB,cAAQ4B,IAAR,CAAa,aAAb;AACA5B,cAAQ6B,SAAR;AACD,KALD,MAKO;AACL7B,cAAQ4B,IAAR,CAAa,wBAAb;AACA5B,cAAQ8B,aAAR,CAAsB,wBAAa/B,WAAnC;AACD;AACF,GAlDkC,CAArC;AAoDD,CArDD;;kBAuDeH,yB","file":"reservation.js","sourcesContent":["const builder = require(\"botbuilder\");\r\nimport { reservationService } from \"../../database\";\r\nimport { DIALOG_NAMES, ENTITY_NAMES } from \"../constants\";\r\n\r\nconst registerReservationDialog = bot => {\r\n  bot.dialog(DIALOG_NAMES.RESERVATION, [\r\n    (session, args, next) => {\r\n      session.dialogData.reservation = {};\r\n      const reservationDate = args && builder.EntityRecognizer.findEntity(\r\n        args.entities,\r\n        ENTITY_NAMES.DATE_TIME\r\n      );\r\n      if (!reservationDate) {\r\n        builder.Prompts.time(\r\n          session,\r\n          \"What time would you like to book?\"\r\n        );\r\n      } else {\r\n        session.dialogData.reservation.date = reservationDate;\r\n        next();\r\n      }\r\n    },\r\n    (session, results) => {\r\n      if (!session.dialogData.reservation.reservationDate) {\r\n        const reservationDate = builder.EntityRecognizer.parseTime(\r\n          results.response.entity\r\n        );\r\n        session.dialogData.reservation.date = reservationDate;\r\n      }\r\n      builder.Prompts.number(session, \"How many people in your group?\");\r\n    },\r\n    (session, results) => {\r\n      session.dialogData.reservation.groupSize = results.response;\r\n      builder.Prompts.text(session, `Can I have a name for the booking?`);\r\n    },\r\n    (session, results) => {\r\n      session.dialogData.reservation.name = results.response;\r\n      const reservationDetails = session.dialogData.reservation;\r\n      builder.Prompts.choice(\r\n        session,\r\n        `Thanks ${reservationDetails.name}. You've asked to make a booking for ${reservationDetails.groupSize} people, on ${reservationDetails.date}.Is that correct?`,\r\n        \"Yes|No\",\r\n        { listStyle: builder.ListStyle.button }\r\n      );\r\n    },\r\n    (session, results) => {\r\n      if (results.response.entity.toLowerCase() === \"yes\") {\r\n        const reservationDetails = session.dialogData.reservation;\r\n        reservationService.addItem(reservationDetails);\r\n        session.send(\"Thank you!.\");\r\n        session.endDialog();\r\n      } else {\r\n        session.send(\"Okay lets try again...\");\r\n        session.replaceDialog(DIALOG_NAMES.RESERVATION);\r\n      }\r\n    }\r\n  ]);\r\n};\r\n\r\nexport default registerReservationDialog;\r\n"]}