{"version":3,"sources":["../../src/bot/index.js"],"names":["builder","require","azure","dotenv","config","DATABASE_NAME","BOT_DATA_COLLECTION_NAME","INTENT_NAMES","DIALOG_NAMES","createDialogs","KoaChatConnector","documentDbOptions","host","process","env","COSMOSDB_HOST","masterKey","COSMOSDB_KEY","database","collection","connector","appId","MicrosoftAppId","appPassword","MicrosoftAppPassword","bot","UniversalBot","docDbClient","DocumentDbClient","cosmosStorage","AzureBotStorage","gzipData","set","luisAppId","LuisAppId","luisAPIKey","LuisAPIKey","luisAPIHostName","LuisAPIHostName","Error","LuisModelUrl","recognizer","LuisRecognizer","intents","IntentDialog","recognizers","matches","GREETING","session","beginDialog","START","ORDER","send","message","text","RESERVATION","args","START_OVER","CANCEL","onDefault","dialog"],"mappings":"AAAA,IAAIA,UAAUC,QAAQ,YAAR,CAAd;AACA,IAAIC,QAAQD,QAAQ,kBAAR,CAAZ;AACA,OAAOE,MAAP,MAAmB,QAAnB;AACAA,OAAOC,MAAP;AACA,SAASC,aAAT,EAAwBC,wBAAxB,QAAwD,sBAAxD;AACA,SAASC,YAAT,EAAuBC,YAAvB,QAA2C,aAA3C;AACA,OAAOC,aAAP,MAA0B,WAA1B;AACA,SAASC,gBAAT,QAAiC,sBAAjC;;AAEA,IAAIC,oBAAoB;AACpBC,UAAMC,QAAQC,GAAR,CAAYC,aADE;AAEpBC,eAAWH,QAAQC,GAAR,CAAYG,YAFH;AAGpBC,cAAUb,aAHU;AAIpBc,gBAAYb;AAJQ,CAAxB;;AAOA;AACA,OAAO,MAAMc,YAAY,IAAIV,gBAAJ,CAAqB;AAC5CW,WAAOR,QAAQC,GAAR,CAAYQ,cADyB;AAE5CC,iBAAaV,QAAQC,GAAR,CAAYU;AAFmB,CAArB,CAAlB;;AAKP;AACA,MAAMC,MAAM,IAAIzB,QAAQ0B,YAAZ,CAAyBN,SAAzB,CAAZ;AACA,IAAIO,cAAc,IAAIzB,MAAM0B,gBAAV,CAA2BjB,iBAA3B,CAAlB;AACA,IAAIkB,gBAAgB,IAAI3B,MAAM4B,eAAV,CAA0B,EAAEC,UAAU,KAAZ,EAA1B,EAA+CJ,WAA/C,CAApB;AACAF,IAAIO,GAAJ,CAAQ,SAAR,EAAmBH,aAAnB;;AAEA;AACA,MAAMI,YAAYpB,QAAQC,GAAR,CAAYoB,SAA9B;AACA,MAAMC,aAAatB,QAAQC,GAAR,CAAYsB,UAA/B;AACA,MAAMC,kBAAkBxB,QAAQC,GAAR,CAAYwB,eAApC;AACA,IAAI,CAACL,SAAD,IAAc,CAACE,UAAf,IAA6B,CAACE,eAAlC,EAAmD;AACjD,UAAM,IAAIE,KAAJ,CAAU,qCAAV,CAAN;AACD;;AAED,MAAMC,eAAgB,6DAA4DP,SAAU,qBAAoBE,UAAW,EAA3H;;AAEA;AACA,IAAIM,aAAa,IAAIzC,QAAQ0C,cAAZ,CAA2BF,YAA3B,CAAjB;AACA,IAAIG,UAAU,IAAI3C,QAAQ4C,YAAZ,CAAyB,EAAEC,aAAa,CAACJ,UAAD,CAAf,EAAzB,EACbK,OADa,CACLvC,aAAawC,QADR,EACmBC,OAAD,IAAa;AACzCA,YAAQC,WAAR,CAAoBzC,aAAa0C,KAAjC;AACH,CAHa,EAIbJ,OAJa,CAILvC,aAAa4C,KAJR,EAIgBH,OAAD,IAAa;AACtCA,YAAQI,IAAR,CAAa,4CAAb,EAA2DJ,QAAQK,OAAR,CAAgBC,IAA3E;AACH,CANa,EAObR,OAPa,CAOLvC,aAAagD,WAPR,EAOqB,CAACP,OAAD,EAAUQ,IAAV,KAAmB;AAClDR,YAAQC,WAAR,CAAoBzC,aAAa+C,WAAjC,EAA8CC,IAA9C;AACH,CATa,EAUbV,OAVa,CAULvC,aAAakD,UAVR,EAUqBT,OAAD,IAAa;AAC3CA,YAAQI,IAAR,CAAa,0BAAb,EAAyCJ,QAAQK,OAAR,CAAgBC,IAAzD;AACAN,YAAQC,WAAR,CAAoBzC,aAAa0C,KAAjC,EAAwCM,IAAxC;AACH,CAba,EAcbV,OAda,CAcLvC,aAAamD,MAdR,EAciBV,OAAD,IAAa;AACvCA,YAAQI,IAAR,CAAa,kCAAb,EAAiDJ,QAAQK,OAAR,CAAgBC,IAAjE;AACH,CAhBa,EAiBbK,SAjBa,CAiBFX,OAAD,IAAa;AACpBA,YAAQI,IAAR,CAAa,qCAAb,EAAoDJ,QAAQK,OAAR,CAAgBC,IAApE;AACH,CAnBa,CAAd;;AAqBA7B,IAAImC,MAAJ,CAAW,GAAX,EAAgBjB,OAAhB;AACAlC,cAAcgB,GAAd","file":"index.js","sourcesContent":["var builder = require('botbuilder');\r\nvar azure = require('botbuilder-azure'); \r\nimport dotenv from 'dotenv';\r\ndotenv.config()\r\nimport { DATABASE_NAME, BOT_DATA_COLLECTION_NAME } from '../database/contants'\r\nimport { INTENT_NAMES, DIALOG_NAMES } from './constants';\r\nimport createDialogs from './dialogs';\r\nimport { KoaChatConnector } from './koa-chat-connector';\r\n\r\nvar documentDbOptions = {\r\n    host: process.env.COSMOSDB_HOST, \r\n    masterKey: process.env.COSMOSDB_KEY, \r\n    database: DATABASE_NAME,   \r\n    collection: BOT_DATA_COLLECTION_NAME\r\n};\r\n\r\n// Configure the connector\r\nexport const connector = new KoaChatConnector({\r\n  appId: process.env.MicrosoftAppId,\r\n  appPassword: process.env.MicrosoftAppPassword\r\n});\r\n\r\n// Setup the bot with CosmosDB Storage\r\nconst bot = new builder.UniversalBot(connector);\r\nvar docDbClient = new azure.DocumentDbClient(documentDbOptions);\r\nvar cosmosStorage = new azure.AzureBotStorage({ gzipData: false }, docDbClient);\r\nbot.set('storage', cosmosStorage);\r\n\r\n//configure LUIS\r\nconst luisAppId = process.env.LuisAppId;\r\nconst luisAPIKey = process.env.LuisAPIKey;\r\nconst luisAPIHostName = process.env.LuisAPIHostName;\r\nif (!luisAppId || !luisAPIKey || !luisAPIHostName) {\r\n  throw new Error(\"Required LUIS settings are not set.\");\r\n}\r\n\r\nconst LuisModelUrl = `https://westus.api.cognitive.microsoft.com/luis/v2.0/apps/${luisAppId}?subscription-key=${luisAPIKey}`;\r\n\r\n// Main dialog with LUIS\r\nvar recognizer = new builder.LuisRecognizer(LuisModelUrl);\r\nvar intents = new builder.IntentDialog({ recognizers: [recognizer] })\r\n.matches(INTENT_NAMES.GREETING, (session) => {\r\n    session.beginDialog(DIALOG_NAMES.START);\r\n})\r\n.matches(INTENT_NAMES.ORDER, (session) => {\r\n    session.send('You reached Order intent, you said \\'%s\\'.', session.message.text);\r\n})\r\n.matches(INTENT_NAMES.RESERVATION, (session, args) => {\r\n    session.beginDialog(DIALOG_NAMES.RESERVATION, args);\r\n})\r\n.matches(INTENT_NAMES.START_OVER, (session) => {\r\n    session.send(\"Alright let's start over\", session.message.text);\r\n    session.beginDialog(DIALOG_NAMES.START, args);\r\n})\r\n.matches(INTENT_NAMES.CANCEL, (session) => {\r\n    session.send(\"Alright I'll cancel your request\", session.message.text);\r\n})\r\n.onDefault((session) => {\r\n    session.send('Sorry, I did not understand \\'%s\\'.', session.message.text);\r\n});\r\n\r\nbot.dialog('/', intents); \r\ncreateDialogs(bot);  \r\n\r\n\r\n"]}